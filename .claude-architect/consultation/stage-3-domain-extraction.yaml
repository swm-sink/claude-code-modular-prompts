# Stage 3: Domain Extraction (7-10 minutes)
# Business logic, terminology, workflows, and domain-specific patterns
# Purpose: Extract the business knowledge that makes your project unique

# =============================================================================
# STAGE OVERVIEW
# =============================================================================
stage_info:
  name: "Domain Extraction"
  duration: "7-10 minutes"
  sequence: 3
  objective: "Capture business logic, terminology, and domain-specific workflows"
  value_statement: "Let's capture the business knowledge that makes your project special"
  
  personality: "Business analyst understanding domain expertise"
  tone: "Collaborative, detail-focused, respectful of domain complexity"
  approach: "Systematic extraction of business concepts and terminology"

# =============================================================================
# STAGE TRANSITION & CONTEXT BRIDGING (1 minute)
# =============================================================================
transition:
  context_bridge: |
    "Excellent! Now I understand your technical foundation - [TECH_STACK] 
    with [ARCHITECTURE_PATTERN] architecture. Let's shift to the business 
    side. Every project has unique domain knowledge - the business concepts, 
    terminology, and workflows that make it special."
  
  value_explanation: |
    "This helps Claude understand your specific language and business logic. 
    Instead of generic responses, Claude will speak your domain language and 
    understand your business context."
  
  stage_preview: |
    "I'll explore three areas:
    1. Core business concepts and terminology (3-4 minutes)
    2. Key workflows and user journeys (2-3 minutes)
    3. Data relationships and integrations (2-3 minutes)
    
    Ready to dive into your domain?"

# =============================================================================
# CORE DOMAIN EXPLORATION (6-8 minutes)
# =============================================================================
question_flows:
  # ---------------------------------------------------------------------------
  # Flow A: Business Concepts and Terminology (3-4 minutes)
  # ---------------------------------------------------------------------------
  business_entities:
    core_entity_discovery: |
      "What are the main 'things' your system works with? The core business 
      entities that everything revolves around?"
    
    entity_clarification: |
      "For example, an e-commerce system works with Products, Orders, Customers. 
      A healthcare system might work with Patients, Providers, Appointments. 
      What are yours?"
    
    terminology_extraction: |
      "Are there specific terms or language that are important in your domain? 
      Industry jargon, company-specific terms, or concepts that have particular 
      meaning in your context?"
    
    domain_specific_concepts:
      ecommerce_detected:
        entities: ["Products", "Orders", "Customers", "Inventory", "Payments"]
        terminology: ["SKU", "Cart abandonment", "Conversion rate", "Fulfillment"]
        questions: 
          - "How do you handle product variants and pricing?"
          - "What's your order lifecycle and status flow?"
          - "How do you manage inventory and stock?"
      
      finance_detected:
        entities: ["Accounts", "Transactions", "Portfolio", "Assets", "Risk"]
        terminology: ["AUM", "NAV", "Compliance", "Reconciliation", "Settlement"]
        questions:
          - "What types of transactions do you process?"
          - "How do you handle account hierarchies?"
          - "What compliance rules are critical?"
      
      healthcare_detected:
        entities: ["Patients", "Providers", "Appointments", "Records", "Claims"]
        terminology: ["EHR", "ICD codes", "HIPAA", "Care plans", "Billing"]
        questions:
          - "What's your patient data model?"
          - "How do you handle provider workflows?"
          - "What compliance requirements drive your design?"
      
      saas_detected:
        entities: ["Users", "Organizations", "Subscriptions", "Features", "Usage"]
        terminology: ["MRR", "Churn", "Onboarding", "Feature flags", "Billing cycles"]
        questions:
          - "How do you model user permissions and roles?"
          - "What's your subscription and billing model?"
          - "How do you track feature usage and adoption?"
    
    business_rules_discovery: |
      "What are the most important business rules or logic? The 'if this, then that' 
      rules that govern how your system behaves?"

  # ---------------------------------------------------------------------------
  # Flow B: User Workflows and Journeys (2-3 minutes)
  # ---------------------------------------------------------------------------
  workflow_mapping:
    primary_workflows: |
      "What are the main things people do in your system? Walk me through 
      the 2-3 most common or important user workflows."
    
    workflow_depth_exploration:
      customer_facing: |
        "For your main users, what's their typical journey from start to finish? 
        What are the key steps and decision points?"
      
      admin_operations: |
        "What about administrative or operational workflows? What do managers, 
        admins, or operators need to do regularly?"
      
      system_processes: |
        "Are there important background processes or automated workflows? 
        Things that happen without direct user interaction?"
    
    complexity_identification: |
      "Which workflows are the most complex or error-prone? Where do people 
      get stuck or confused?"
    
    workflow_validation: |
      "Let me check my understanding of your key workflows:
      
      **Primary User Flow**: [USER_WORKFLOW]
      **Administrative Flow**: [ADMIN_WORKFLOW]  
      **Complex/Critical Flow**: [COMPLEX_WORKFLOW]
      
      Does this capture the main pathways through your system?"

  # ---------------------------------------------------------------------------
  # Flow C: Data Relationships and Integrations (2-3 minutes)
  # ---------------------------------------------------------------------------
  data_integration_patterns:
    data_relationships: |
      "How do your main business entities relate to each other? What are the 
      important connections and dependencies?"
    
    external_integrations: |
      "What external systems do you integrate with? Payment processors, 
      analytics tools, third-party APIs, or other services?"
    
    data_flow_patterns: |
      "How does data flow through your system? Where does it come from, 
      how is it processed, and where does it go?"
    
    integration_challenges: |
      "Are there any particularly tricky integrations or data synchronization 
      challenges? APIs that are difficult to work with or data that's hard to manage?"
    
    data_validation_patterns: |
      "How do you handle data validation and business logic enforcement? 
      Where do you validate business rules - frontend, backend, database?"

# =============================================================================
# ADAPTIVE DOMAIN INTELLIGENCE
# =============================================================================
domain_specialization:
  # ---------------------------------------------------------------------------
  # E-commerce Domain Patterns
  # ---------------------------------------------------------------------------
  ecommerce:
    key_entities:
      - "Products (variants, bundles, configurations)"
      - "Orders (cart, checkout, fulfillment)"
      - "Customers (accounts, segments, preferences)"
      - "Inventory (stock, reservations, suppliers)"
      - "Payments (methods, processing, refunds)"
    
    critical_workflows:
      - "Browse → Cart → Checkout → Fulfillment"
      - "Product catalog management"
      - "Inventory management and restocking"
      - "Order processing and customer service"
    
    integration_patterns:
      - "Payment processors (Stripe, PayPal)"
      - "Shipping carriers (FedEx, UPS)"
      - "Analytics (Google Analytics, custom)"
      - "Email marketing (Mailchimp, SendGrid)"
    
    domain_questions:
      - "How do you handle product variants and pricing rules?"
      - "What's your approach to inventory management?"
      - "How do you process returns and refunds?"
      - "What customer segmentation do you use?"

  # ---------------------------------------------------------------------------
  # Financial Services Domain Patterns
  # ---------------------------------------------------------------------------
  finance:
    key_entities:
      - "Accounts (types, hierarchies, ownership)"
      - "Transactions (types, processing, settlement)"
      - "Portfolio (holdings, performance, allocation)"
      - "Risk (assessment, monitoring, reporting)"
      - "Compliance (rules, monitoring, reporting)"
    
    critical_workflows:
      - "Account opening and KYC verification"
      - "Transaction processing and settlement"
      - "Portfolio rebalancing and management"
      - "Risk assessment and monitoring"
      - "Regulatory reporting and compliance"
    
    integration_patterns:
      - "Market data providers (Bloomberg, Reuters)"
      - "Banking systems (ACH, wire transfers)"
      - "Regulatory reporting systems"
      - "Risk management platforms"
    
    domain_questions:
      - "What types of financial instruments do you handle?"
      - "How do you manage regulatory compliance?"
      - "What's your approach to risk assessment?"
      - "How do you handle transaction reconciliation?"

  # ---------------------------------------------------------------------------
  # Healthcare Domain Patterns
  # ---------------------------------------------------------------------------
  healthcare:
    key_entities:
      - "Patients (demographics, medical history)"
      - "Providers (practitioners, facilities)"
      - "Appointments (scheduling, availability)"
      - "Medical records (EHR, imaging, labs)"
      - "Claims and billing (insurance, coding)"
    
    critical_workflows:
      - "Patient registration and intake"
      - "Appointment scheduling and management"
      - "Clinical documentation and records"
      - "Insurance verification and billing"
      - "Care coordination and referrals"
    
    integration_patterns:
      - "EHR systems (Epic, Cerner)"
      - "Insurance systems and clearinghouses"
      - "Lab systems and imaging"
      - "Pharmacy and medication management"
    
    domain_questions:
      - "How do you handle patient privacy and HIPAA compliance?"
      - "What's your clinical workflow process?"
      - "How do you manage insurance and billing?"
      - "What integration standards do you follow (HL7, FHIR)?"

# =============================================================================
# PROJECT TYPE ADAPTIVE QUESTIONING
# =============================================================================
project_type_focus:
  internal_tools:
    focus_areas:
      - "Employee workflows and processes"
      - "Business process optimization"
      - "Internal data and reporting needs"
      - "Integration with existing systems"
    
    key_questions:
      - "What business process does this tool optimize?"
      - "Who are the primary users and what are their roles?"
      - "How does this fit into existing workflows?"
      - "What data sources and systems does it connect to?"
  
  customer_facing_products:
    focus_areas:
      - "User experience and journey mapping"
      - "Business model and value proposition"
      - "Customer segmentation and personalization"
      - "Growth and conversion optimization"
    
    key_questions:
      - "Who is your target customer and what problem do you solve?"
      - "What's the core value proposition and user journey?"
      - "How do you segment users and personalize experience?"
      - "What metrics drive your business decisions?"
  
  api_platform:
    focus_areas:
      - "Developer experience and integration patterns"
      - "API design and data models"
      - "Rate limiting and usage patterns"
      - "Documentation and developer tools"
    
    key_questions:
      - "Who consumes your API and what do they build?"
      - "What are your core data models and operations?"
      - "How do you handle authentication and authorization?"
      - "What developer tools and documentation do you provide?"

# =============================================================================
# UNDERSTANDING VALIDATION & SYNTHESIS
# =============================================================================
domain_synthesis:
  comprehensive_summary: |
    "Let me synthesize what I understand about your domain:
    
    **Core Business Entities**: [ENTITY_LIST]
    **Key Domain Terminology**: [TERMINOLOGY_LIST]
    **Primary Workflows**: 
    - [WORKFLOW_1]
    - [WORKFLOW_2]
    - [WORKFLOW_3]
    
    **Critical Business Rules**: [BUSINESS_RULES]
    **External Integrations**: [INTEGRATION_LIST]
    **Data Flow Patterns**: [DATA_PATTERNS]
    **Complex/Critical Areas**: [COMPLEXITY_AREAS]
    
    Does this capture the essence of your business domain?"
  
  domain_expertise_validation: |
    "What's the most important domain knowledge that Claude should understand? 
    What would make the biggest difference in the quality of responses?"
  
  gap_identification: |
    "Is there any important domain context or terminology I haven't captured? 
    Any business concepts that are particularly unique to your industry or company?"

# =============================================================================
# TRANSITION CRITERIA & PREPARATION
# =============================================================================
completion_requirements:
  must_have_before_stage_4:
    - "Core business entities identified"
    - "Domain terminology captured"
    - "Primary user workflows mapped"
    - "Key business rules understood"
  
  nice_to_have:
    - "External integrations documented"
    - "Data relationships understood"
    - "Complex workflows identified"
    - "Industry-specific patterns noted"

stage_4_preparation:
  domain_context_established:
    - "Business vocabulary and terminology defined"
    - "Workflow complexity and patterns understood"
    - "Integration requirements and constraints identified"
    - "Critical business logic and rules captured"
  
  preferences_transition_setup:
    - "Domain complexity level guides style preferences"
    - "Business formality informs communication preferences"
    - "Workflow patterns suggest command and documentation needs"
    - "Integration patterns inform tool and format preferences"

# =============================================================================
# TRANSITION TO STAGE 4
# =============================================================================
stage_transition:
  domain_completion: |
    "Excellent! I now have a solid understanding of your business domain 
    and the unique aspects of your project. The final piece is understanding 
    your team's preferences and working style."
  
  preferences_preview: |
    "This last stage is quick - about 3-5 minutes. I'll ask about your coding 
    standards, documentation preferences, and how you like to work. This ensures 
    Claude matches your team's style and conventions."
  
  context_handoff_to_stage_4:
    domain_foundation:
      - "Business entity model and terminology"
      - "Workflow patterns and user journeys"
      - "Business rules and logic patterns"
      - "Integration patterns and external dependencies"
      - "Domain complexity and specialization level"
    
    enables_preference_customization:
      - "Domain complexity guides documentation depth preferences"
      - "Business formality informs communication style preferences"  
      - "Workflow patterns suggest command structure preferences"
      - "Integration complexity informs tool preference questions"
      - "Industry context guides convention and standard preferences"