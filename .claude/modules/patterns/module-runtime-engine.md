# Module Runtime Engine

```xml
<module_runtime_engine version = "3.0.0" enforcement = "CRITICAL">
  <purpose>Deterministic module composition and execution engine for Claude 4 with standardized patterns, universal quality gates, and comprehensive TDD enforcement</purpose>
  
  <runtime_architecture>
    <thinking_engine>Checkpoint patterns | TDD mandatory | 30s critical thinking | Validation gates</thinking_engine>
    <composition>Discovery→Loading→Orchestration→Integration | Topological sorting | State isolation</composition>
    <quality_gates>Foundational | Development | Coordination | Documentation | Analysis</quality_gates>
    <sources>modules/patterns/thinking-pattern-template.md | modules/patterns/module-composition-framework.md | system/quality/universal-quality-gates.md</sources>
  </runtime_architecture>
  
  <command_runtime_specification>
    <structure>Checkpoint thinking | TDD enforcement | Core+contextual+support modules | Quality gates</structure>
    <implementations>
      <task>Single TDD | critical-thinking→tdd→task-management→production | BLOCK: TDD violations</task>
      <swarm>Multi-agent | critical-thinking→session→multi-agent→tdd→git→production | BLOCK: coordination failures</swarm>
      <auto>Intelligent routing | critical-thinking→routing→tdd→patterns | BLOCK: non-TDD routes</auto>
      <query>Read-only analysis | critical-thinking→research→patterns→tdd | BLOCK: modifications</query>
      <session>Session tracking | critical-thinking→session→tdd→git | BLOCK: incomplete tracking</session>
      <protocol>Production strict | critical-thinking→session→production→tdd→threat→precommit | BLOCK: ANY failure</protocol>
      <docs>Documentation gateway | critical-thinking→docs→routing→tdd | BLOCK: gateway violations</docs>
    </implementations>
  </command_runtime_specification>
  
  <tdd_integration>
    <canonical_source>.claude/modules/patterns/tdd-cycle-pattern.md</canonical_source>
    <enforcement>Commands delegate to TDD module for detailed cycle enforcement and validation procedures</enforcement>
  </tdd_integration>
  
  <execution_optimization>
    <parallel>Tool batching | Independent modules | Dependency optimization</parallel>
    <context>State maintenance | Result accumulation | Error isolation</context>
    <targets>Commands: <2min | Loading: <10s | Gates: <30s | SWE-bench verified gains</targets>
  </execution_optimization>
  
  <error_handling>
    <types>Module | TDD | Quality | Coordination failures</types>
    <recovery>Graceful degradation | Exponential backoff | Escalation | Rollback</recovery>
    <levels>BLOCKING | CONDITIONAL | WARNING</levels>
  </error_handling>
  
  <integration_points>
    <core_framework_integration>
      <claude_4_control>Thinking patterns optimized for Claude 4 interpretation</claude_4_control>
      <file_discipline>Module composition respects file organization rules</file_discipline>
      <quality_gates>Universal quality gates integrated with existing framework standards</quality_gates>
      <github_workflow>Session management and issue tracking integration</github_workflow>
    </core_framework_integration>
    
    <module_dependencies>
      <thinking_patterns>modules/patterns/thinking-pattern-template.md for standardized checkpoints</thinking_patterns>
      <composition_framework>modules/patterns/module-composition-framework.md for runtime orchestration</composition_framework>
      <quality_gates>system/quality/universal-quality-gates.md for comprehensive validation</quality_gates>
      <tdd_enforcement>modules/patterns/tdd-cycle-pattern.md for strict test-driven development</tdd_enforcement>
    </module_dependencies>
  </integration_points>
  
  <version_integration>
    <framework_version>Advances framework to 3.0.0 with Claude 4 optimization and hallucination prevention</framework_version>
    <backward_compatibility>Full compatibility with existing 2.6.x commands and modules</backward_compatibility>
    <migration_path>Existing commands automatically benefit from enhanced runtime</migration_path>
    <future_evolution>Foundation for deterministic AI agent coordination</future_evolution>
  </version_integration>
  
  <monitoring_and_metrics>
    <execution_metrics>Module load time, execution time, success rates, parallel efficiency</execution_metrics>
    <quality_metrics>TDD compliance rate, quality gate pass rate, error recovery effectiveness</quality_metrics>
    <performance_metrics>Command completion time, resource usage, throughput improvement</performance_metrics>
    <continuous_improvement>Feedback collection, optimization opportunities, pattern refinement</continuous_improvement>
  </monitoring_and_metrics>
</module_runtime_engine>
```