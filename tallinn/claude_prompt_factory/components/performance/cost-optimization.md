<prompt_component>
  <step name="Cost Optimization and Budget Management">
    <description>
Advanced cost optimization system that provides intelligent budget management, real-time cost tracking, and usage analytics. Monitors token consumption, tracks costs across operations, and implements optimization strategies for maximum efficiency and budget control.
    </description>
  </step>

  <cost_optimization>
    <intelligent_budget_management>
      &lt;!-- Implement cost optimization and budget tracking 
      <real_time_cost_tracking>
        <token_consumption_monitoring>
          <usage_analytics>
            Track token consumption across different operations:
            - Monitor input tokens vs output tokens by command type
            - Track context window utilization efficiency
            - Analyze token costs for different complexity levels
            - Measure cost per successful operation completion
          </usage_analytics>
          
          <cost_attribution>
            Attribute costs to specific activities and users:
            - Per-command cost tracking and analysis
            - User-specific usage patterns and costs
            - Project-level cost allocation and budgeting
            - Feature development cost attribution
          </cost_attribution>
        </token_consumption_monitoring>
        
        <predictive_cost_modeling>
          <usage_forecasting>
            Predict future costs based on patterns:
            - Historical usage trend analysis
            - Seasonal and cyclical pattern recognition
            - Project lifecycle cost prediction
            - Team growth impact on cost projections
          </usage_forecasting>
          
          <budget_alerting>
            Provide proactive budget management:
            - Real-time budget consumption tracking
            - Predictive alerts before budget exhaustion
            - Usage spike detection and notification
            - Cost optimization opportunity identification
          </budget_alerting>
        </predictive_cost_modeling>
      </real_time_cost_tracking>
      
      <optimization_strategies>
        &lt;!-- Advanced cost optimization techniques 
        <context_optimization>
          <smart_context_management>
            Optimize context usage for cost efficiency:
            - Dynamic context sizing based on operation needs
            - Intelligent context pruning and summarization
            - Context sharing and reuse across similar operations
            - Hierarchical context loading for large codebases
          </smart_context_management>
          
          <caching_strategies>
            Implement intelligent caching for cost reduction:
            - Response caching for similar queries
            - Analysis result caching for code patterns
            - Template and example caching
            - Context preprocessing and caching
          </caching_strategies>
        </context_optimization>
        
        <operation_efficiency>
          <batch_processing>
            Optimize operations through batching:
            - Batch similar operations for efficiency
            - Combine related analysis requests
            - Parallel processing of independent operations
            - Queue optimization for cost-effective execution
          </batch_processing>
          
          <operation_selection>
            Choose most cost-effective operation approaches:
            - Simple operations for straightforward tasks
            - Progressive complexity scaling
            - Early termination for unsuccessful operations
            - Alternative approach selection based on cost
          </operation_selection>
        </operation_efficiency>
      </optimization_strategies>
    </intelligent_budget_management>
    
    <resource_allocation>
      &lt;!-- Intelligent resource allocation and management 
      <dynamic_resource_scaling>
        <demand_based_allocation>
          <usage_pattern_analysis>
            Allocate resources based on actual usage patterns:
            - Peak usage time identification and preparation
            - Resource scaling for anticipated demand
            - Idle resource identification and deallocation
            - Cost-performance optimization curves
          </usage_pattern_analysis>
          
          <priority_based_resource_management>
            Manage resources based on operation priority:
            - Critical operation resource guarantee
            - Background task resource limitation
            - User tier-based resource allocation
            - Project priority-based resource distribution
          </priority_based_resource_management>
        </demand_based_allocation>
        
        <cost_aware_scheduling>
          <operation_scheduling>
            Schedule operations for optimal cost efficiency:
            - Off-peak scheduling for non-urgent operations
            - Batch scheduling for similar operations
            - Resource consolidation opportunities
            - Cost-sensitive operation timing
          </operation_scheduling>
          
          <resource_pooling>
            Implement resource pooling for efficiency:
            - Shared resource pools across teams
            - Resource lending and borrowing mechanisms
            - Overflow capacity management
            - Cross-project resource optimization
          </resource_pooling>
        </cost_aware_scheduling>
      </dynamic_resource_scaling>
      
      <efficiency_optimization>
        <performance_cost_balance>
          <optimization_recommendations>
            Provide recommendations for cost-performance balance:
            - Identify over-provisioned resources
            - Suggest performance optimizations that reduce costs
            - Recommend architectural changes for efficiency
            - Highlight cost-effective alternative approaches
          </optimization_recommendations>
          
          <automated_optimization>
            Implement automated cost optimizations:
            - Automatic context size adjustment
            - Dynamic caching strategy selection
            - Intelligent operation routing
            - Automated resource scaling
          </automated_optimization>
        </performance_cost_balance>
        
        <waste_elimination>
          <resource_waste_identification>
            Identify and eliminate resource waste:
            - Unused or underutilized resources
            - Inefficient operation patterns
            - Redundant processing and operations
            - Suboptimal resource allocation patterns
          </resource_waste_identification>
          
          <optimization_automation>
            Automate waste elimination processes:
            - Automatic idle resource reclamation
            - Redundant operation detection and prevention
            - Efficiency pattern enforcement
            - Cost optimization rule application
          </optimization_automation>
        </waste_elimination>
      </efficiency_optimization>
    </resource_allocation>
    
    <enterprise_cost_management>
      &lt;!-- Enterprise-grade cost management and governance 
      <budget_governance>
        <budget_controls>
          <hierarchical_budgeting>
            Implement hierarchical budget management:
            - Organization-level budget allocation
            - Department and team budget distribution
            - Project-specific budget management
            - Individual user budget controls
          </hierarchical_budgeting>
          
          <budget_enforcement>
            Enforce budget limits and policies:
            - Hard limits for critical budget boundaries
            - Soft limits with approval workflows
            - Grace periods for budget overruns
            - Emergency budget access procedures
          </budget_enforcement>
        </budget_controls>
        
        <cost_accountability>
          <chargeback_mechanisms>
            Implement cost chargeback and accountability:
            - Accurate cost attribution to cost centers
            - Detailed usage reporting and analytics
            - Cost transparency and visibility
            - Fair usage policies and enforcement
          </chargeback_mechanisms>
          
          <cost_center_management>
            Manage costs across different organizational units:
            - Cross-departmental cost allocation
            - Shared resource cost distribution
            - Cost center performance tracking
            - Inter-department cost reconciliation
          </cost_center_management>
        </cost_accountability>
      </budget_governance>
      
      <financial_optimization>
        <procurement_optimization>
          <volume_discounting>
            Optimize procurement for volume discounts:
            - Usage volume tracking and forecasting
            - Discount tier optimization
            - Contract negotiation support
            - Multi-year commitment optimization
          </volume_discounting>
          
          <vendor_management>
            Optimize vendor relationships for cost efficiency:
            - Multi-vendor cost comparison
            - Service level optimization
            - Contract terms optimization
            - Alternative vendor evaluation
          </vendor_management>
        </procurement_optimization>
        
        <financial_planning>
          <cost_forecasting>
            Provide accurate cost forecasting:
            - Historical trend analysis
            - Growth projection modeling
            - Scenario-based cost planning
            - Budget variance analysis and correction
          </cost_forecasting>
          
          <roi_analysis>
            Analyze return on investment for optimizations:
            - Cost optimization impact measurement
            - Productivity improvement quantification
            - Cost-benefit analysis for new features
            - Long-term value optimization
          </roi_analysis>
        </financial_planning>
      </financial_optimization>
    </enterprise_cost_management>
    
    <reporting_analytics>
      &lt;!-- Comprehensive cost reporting and analytics 
      <cost_visibility>
        <real_time_dashboards>
          <executive_dashboards>
            Provide executive-level cost visibility:
            - High-level cost trends and projections
            - Budget performance and variance analysis
            - Cost optimization opportunity identification
            - ROI and efficiency metrics
          </executive_dashboards>
          
          <operational_dashboards>
            Provide operational cost management tools:
            - Real-time usage monitoring
            - Cost per operation tracking
            - Resource utilization efficiency
            - Optimization recommendation prioritization
          </operational_dashboards>
        </real_time_dashboards>
        
        <detailed_analytics>
          <cost_breakdown_analysis>
            Provide detailed cost breakdown and analysis:
            - Cost distribution across operations and users
            - Trend analysis for different cost components
            - Comparative analysis across time periods
            - Anomaly detection and investigation
          </cost_breakdown_analysis>
          
          <optimization_impact_tracking>
            Track the impact of optimization initiatives:
            - Before/after optimization comparisons
            - Optimization ROI measurement
            - Long-term trend impact analysis
            - Success metric tracking and reporting
          </optimization_impact_tracking>
        </detailed_analytics>
      </cost_visibility>
      
      <actionable_insights>
        <recommendation_engine>
          <intelligent_recommendations>
            Provide AI-powered cost optimization recommendations:
            - Pattern-based optimization suggestions
            - Predictive optimization opportunities
            - Custom recommendations based on usage patterns
            - Priority-ranked action items
          </intelligent_recommendations>
          
          <impact_estimation>
            Estimate the impact of optimization recommendations:
            - Cost savings potential calculation
            - Implementation effort estimation
            - Risk assessment for optimization changes
            - Timeline and milestone planning
          </impact_estimation>
        </recommendation_engine>
        
        <continuous_improvement>
          <feedback_loops>
            Implement feedback loops for continuous optimization:
            - Optimization effectiveness tracking
            - User satisfaction with cost management
            - System performance impact monitoring
            - Adjustment and refinement processes
          </feedback_loops>
          
          <learning_integration>
            Learn from optimization outcomes:
            - Success pattern identification
            - Failure analysis and learning
            - Best practice documentation
            - Knowledge sharing and dissemination
          </learning_integration>
        </continuous_improvement>
      </actionable_insights>
    </reporting_analytics>
  </cost_optimization>

  <output>
    Optimization framework completed with enhanced performance:

    **Performance Gain:** [percentage]% improvement achieved
    **Resource Efficiency:** [count] optimization strategies implemented
    **System Performance:** [percentage]% performance baseline improvement
    **Optimization Metrics:** [0-100] optimization effectiveness rating
    **Advanced Optimization:** Comprehensive performance enhancement with intelligent tuning
  </output>

</prompt_component>